<!doctype html>
<html lang="ko">
<head><meta charset="utf-8"><title>#{{ ticket.id }} - {{ ticket.title }}</title></head>
<body>
  <h2>[#{{ ticket.id }}] {{ ticket.title }}</h2>
  <p>요청자: {{ ticket.requester }} / 담당자: {{ ticket.assignee or "-" }}</p>
  <p>상태: {{ ticket.status|k_status }} · 우선순위: {{ ticket.priority|k_priority }}</p>

  <!-- 상태/담당자/우선 저장 -->
  <form method="post" action="{{ url_for('ticket_update', tid=ticket.id) }}">
    <select name="status">
      {% for v,lab in STATUS_CHOICES %}
        <option value="{{v}}" {{ "selected" if ticket.status==v else "" }}>{{ lab }}</option>
      {% endfor %}
    </select>
    <input name="assignee" placeholder="담당자" value="{{ ticket.assignee or "" }}">
    <select name="priority">
      {% for v,lab in PRIORITY_CHOICES %}
        <option value="{{v}}" {{ "selected" if ticket.priority==v else "" }}>{{ lab }}</option>
      {% endfor %}
    </select>
    <button>저장</button>
  </form>

  <hr>

  <h3>댓글</h3>
  <form method="post" action="{{ url_for('ticket_comment', tid=ticket.id) }}">
    <input name="author" placeholder="작성자(옵션)">
    <input name="content" placeholder="댓글 내용을 입력하세요">
    <button>등록</button>
  </form>
  <ul>
    {% for c in comments %}
      <li>{{ c.created_at|dt }} · <b>{{ c.author or 'user' }}</b> : {{ c.content }}</li>
    {% else %}
      <li>댓글 없음</li>
    {% endfor %}
  </ul>

  <hr>

<h3>첨부</h3>
<form method="post"
      action="{{ url_for('upload_attach', tid=ticket.id) }}"
      enctype="multipart/form-data">
  <input type="file" name="file">
  <button>업로드</button>
</form>

<ul>
  {% for a in atts %}
    <li>
      <a href="{{ url_for('download_file', aid=a.id) }}">{{ a.filename }}</a>
      ({{ (a.size/1024)|round(1) }} KB, {{ a.created_at|dt }})
    </li>
  {% else %}
    <li>첨부 없음</li>
  {% endfor %}
</ul>

  <p><a href="{{ url_for('index') }}">← 목록</a></p>
</body>
</html>
